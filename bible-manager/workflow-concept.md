# Детальный рабочий процесс в системе с ModelContextProtocol

## Подготовительный этап

1. **Инициализация системы**
   - Создание исходных файлов библии мира, канона и структуры сюжета
   - Загрузка этих файлов как базовых контекстов в ModelContextProtocol
   - Настройка параметров генерации и анализа

2. **Настройка сюжетного каркаса**
   - Определение основных сюжетных точек и арок персонажей
   - Создание "сюжетного контекста" с ключевыми событиями и связями
   - Установка сюжетных ограничений и целей для будущих сцен

## Итеративный цикл создания контента

### Этап 1: Планирование сцены
```
Автор → Система: Запрос на планирование следующей сцены
Система: Анализирует сюжетный контекст, определяет необходимые элементы
Система → Автор: Предлагает несколько вариантов развития сюжета
Автор: Выбирает направление или модифицирует предложения
Система: Формирует детальный план сцены с учетом библии и канона
```

### Этап 2: Генерация сцены
```
Система: Активирует все релевантные контексты (библия, канон, сюжет, план)
Система: Генерирует текст сцены, соблюдая установленные правила
Система → Автор: Представляет готовую сцену
Автор: Оценивает сцену, вносит редакторские правки при необходимости
```

### Этап 3: Анализ новых элементов
```
Система: Запускает промпт-анализатор для выявления новых элементов
Система: Классифицирует элементы по категориям и потенциальным уровням канона
Система: Проверяет выявленные элементы на согласованность с существующими
Система → Автор: Представляет структурированный отчет с выделенными новыми элементами
```

### Этап 4: Утверждение изменений
```
Автор: Просматривает выявленные новые элементы
Автор: Для каждого элемента определяет:
       - Уровень канона (0-4)
       - Необходимые модификации для согласованности
       - Дополнительные детали и связи
Автор → Система: Передает решения по каждому элементу
```

### Этап 5: Интеграция в библию и канон
```
Система: Обновляет соответствующие разделы библии мира
Система: Обновляет таблицы канона с новыми элементами
Система: Обновляет сюжетный контекст с учетом новых возможностей
Система: Создает журнал изменений для отслеживания эволюции мира
Система → Автор: Подтверждает обновление и показывает сводку изменений
```

### Этап 6: Проверка последствий и обновление (при необходимости)
```
Система: Анализирует потенциальное влияние новых элементов на ранее написанный контент
Система → Автор: Предлагает список сцен, которые могут требовать обновления
Автор: Принимает решение о необходимости обновления конкретных сцен
Система: При необходимости перегенерирует выбранные сцены с обновленными контекстами
```

## Управление большими объемами контекста

1. **Динамическая активация контекстов**
   - Система определяет, какие части библии релевантны для текущей сцены
   - Только необходимые контексты загружаются в активный промпт

2. **Иерархическая организация контекстов**
   - Мир → Регионы → Локации
   - Технологии → Категории → Конкретные устройства
   - Персонажи → Группы → Индивидуумы

3. **Сжатие и резюмирование**
   - Регулярное обновление "сжатых" версий контекстов для основных промптов
   - Детальные версии хранятся отдельно и подгружаются по необходимости

## Процесс принятия решений

1. **Области автоматических решений**
   - Согласованность с установленными правилами
   - Формальная классификация элементов
   - Выявление связей с существующими элементами

2. **Области человеческих решений**
   - Определение уровня канона для новых элементов
   - Разрешение потенциальных противоречий
   - Стратегические решения по развитию сюжета
   - Финальное утверждение крупных изменений

Такой процесс обеспечивает баланс между автоматизацией рутинных задач и сохранением творческого контроля автора, при этом гарантируя целостность и непротиворечивость создаваемого мира.