# Session Management Commands

ะฃะฟัะฐะฒะปะตะฝะธะต ัะตััะธัะผะธ ะดะปั ะธะทะพะปะธัะพะฒะฐะฝะฝะพะน ัะฐะฑะพัั ะฝะฐะด ะบะฝะธะณะพะน ั Copy-on-Write.

## ะะพะดะบะพะผะฐะฝะดั:

### `/session start <name> [description]`
ะกะพะทะดะฐัั ะฝะพะฒัั ัะตััะธั ะธ ะฐะบัะธะฒะธัะพะฒะฐัั ะตั.

**ะัะธะผะตัั:**
```
/session start work-on-chapter-01
/session start experimental-scene-0102 "Trying alternative version"
/session start rewrite-ending "Revising act 1 ending"
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. ะกะพะทะดะฐัััั `workspace/sessions/<name>/` ั ะฟัััะพะน ััััะบัััะพะน (CoW)
2. ะกะตััะธั ะฐะบัะธะฒะธััะตััั (ะทะฐะฟะธััะฒะฐะตััั ะฒ `workspace/session.lock`)
3. ะัะต ะฟะพัะปะตะดัััะธะต ะพะฟะตัะฐัะธะธ ะทะฐะฟะธัะธ ะธะดัั ะฒ ัะตััะธั
4. ะงัะตะฝะธะต ัะฐะนะปะพะฒ: ัะฝะฐัะฐะปะฐ ะธะท ัะตััะธะธ, ะตัะปะธ ะฝะตั - ะธะท global

### `/session list`
ะะพะบะฐะทะฐัั ะฒัะต ัะตััะธะธ (ะฐะบัะธะฒะฝัะต ะธ ะฝะตะฐะบัะธะฒะฝัะต).

**ะัะธะผะตั ะฒัะฒะพะดะฐ:**
```
๐ SESSIONS (3 total)

โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโ
โ Name                   โ Status   โ Created    โ Changes  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโค
โ work-on-chapter-01     โ ACTIVE   โ 2025-11-09 โ 5 files  โ
โ experimental-scene-102 โ INACTIVE โ 2025-11-08 โ 1 file   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโ

๐ Active: work-on-chapter-01
```

### `/session status`
ะะพะบะฐะทะฐัั ะดะตัะฐะปะธ ะฐะบัะธะฒะฝะพะน ัะตััะธะธ.

**ะัะธะผะตั ะฒัะฒะพะดะฐ:**
```
๐ ACTIVE SESSION: work-on-chapter-01

Status: ACTIVE
Created: 2 hours ago

๐ Changes (uncommitted):
   โข Modified: 3 files
   โข Created: 2 files

๐ Human Retries: 2
   โข scene-0101.md: 2 retries

๐พ Size: 2.3 MB
```

### `/session switch <name>`
ะะตัะตะบะปััะธัััั ะฝะฐ ะดััะณัั ัะตััะธั.

**ะัะธะผะตั:**
```
/session switch experimental-scene-0102
```

### `/session commit [name]`
ะะฐะบะพะผะผะธัะธัั ะธะทะผะตะฝะตะฝะธั ะธะท ัะตััะธะธ ะฒ ะณะปะพะฑะฐะปัะฝัะต ัะฐะนะปั (context/, acts/).

**ะัะธะผะตัั:**
```
/session commit                    # ะะพะผะผะธัะธั ะฐะบัะธะฒะฝัั ัะตััะธั
/session commit work-on-chapter-01 # ะะพะผะผะธัะธั ัะบะฐะทะฐะฝะฝัั ัะตััะธั
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. ะะพะบะฐะทัะฒะฐะตั preview ะธะทะผะตะฝะตะฝะธะน
2. ะขัะตะฑัะตั ะฟะพะดัะฒะตัะถะดะตะฝะธะต ัะตัะตะท `force=True`
3. ะะพะฟะธััะตั ะฒัะต CoW ัะฐะนะปั ะธะท session ะฒ global
4. ะััะธะฒะธััะตั human retries
5. ะฃะดะฐะปัะตั ัะตััะธั
6. ะัะธัะฐะตั session.lock

### `/session cancel [name]`
ะัะผะตะฝะธัั ัะตััะธั ะธ ะพัะบะฐัะธัั ะฒัะต ะธะทะผะตะฝะตะฝะธั.

**ะัะธะผะตัั:**
```
/session cancel                    # ะัะผะตะฝัะตั ะฐะบัะธะฒะฝัั ัะตััะธั
/session cancel experimental-v2    # ะัะผะตะฝัะตั ัะบะฐะทะฐะฝะฝัั ัะตััะธั
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. Backup human retries (ะพะฟัะธะพะฝะฐะปัะฝะพ)
2. ะฃะดะฐะปัะตั ะฒัั ะดะธัะตะบัะพัะธั ัะตััะธะธ
3. ะัะธัะฐะตั session.lock
4. ะะปะพะฑะฐะปัะฝัะต ัะฐะนะปั ะะ ะทะฐััะฐะณะธะฒะฐัััั (ะพัะบะฐั)

### `/retry <file> <reason>`
ะะฐะฟะธัะฐัั human retry ะฟะพะฟััะบั.

**ะัะธะผะตัั:**
```
/retry scene-0101.md "Too much exposition, needs more action"
/retry scene-0102.md "Character voice inconsistent"
```

**ะงัะพ ะฟัะพะธััะพะดะธั:**
1. ะะพะฟะธััะตั ัะตะบัััั ะฒะตััะธั ัะฐะนะปะฐ ะฒ `human-retries/`
2. ะกะพััะฐะฝัะตั ะฟัะธัะธะฝั retry
3. ะะฐะฟะธััะฒะฐะตั ะฒ session.json
4. ะัะธัะฒะฐะธะฒะฐะตั ะฝะพะผะตั retry

## ะะฐะฑะพัะธะน ะฟัะพัะตัั (ัะธะฟะธัะฝัะน ััะตะฝะฐัะธะน):

```bash
# 1. ะะฐัะฐัั ัะฐะฑะพัั
/session start work-on-chapter-01

# 2. ะะฐะฑะพัะฐัั ะฝะฐะด ััะตะฝะฐะผะธ (ะณะตะฝะตัะฐัะธั, ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต)
"Generate scene 0101"
"Update chapter-01 plan"

# 3. ะัะปะธ ะฝะต ะฟะพะฝัะฐะฒะธะปะพัั - retry
/retry scene-0101.md "Too much dialogue"
"Regenerate scene 0101 with less dialogue"

# 4. ะัะพะฒะตัะธัั ััะฐััั
/session status

# 5. ะัะปะธ ะดะพะฒะพะปัะฝั - ะบะพะผะผะธัะธะผ
/session commit

# 6. ะัะปะธ ะฝะต ะดะพะฒะพะปัะฝั - ะพัะผะตะฝัะตะผ
/session cancel
```

## Copy-on-Write ะฟัะธะฝัะธะฟ:

- **ะัะธ ัะพะทะดะฐะฝะธะธ ัะตััะธะธ:** ะกะพะทะดะฐัััั ัะพะปัะบะพ ััััะบัััะฐ ะบะฐัะฐะปะพะณะพะฒ (ะฟัััะฐั)
- **ะัะธ ััะตะฝะธะธ ัะฐะนะปะฐ:**
  1. ะัะพะฒะตััะตััั `workspace/sessions/<name>/<path>`
  2. ะัะปะธ ะตััั - ัะธัะฐะตััั ะธะท ัะตััะธะธ
  3. ะัะปะธ ะฝะตั - ัะธัะฐะตััั ะธะท global
- **ะัะธ ะทะฐะฟะธัะธ ัะฐะนะปะฐ:**
  1. ะัะปะธ ัะฐะนะป ะฒะฟะตัะฒัะต ะธะทะผะตะฝัะตััั - ะบะพะฟะธััะตััั ะธะท global ะฒ session (CoW)
  2. ะะฐะฟะธัั ะธะดัั ะฒ session path
  3. ะะพะฑะฐะฒะปัะตััั ะฒ `session.json["cow_files"]`
- **ะัะธ commit:**
  1. ะะพะฟะธัััััั ัะพะปัะบะพ `cow_files` ะธะท session ะฒ global
  2. ะะปะพะฑะฐะปัะฝัะต ัะฐะนะปั ะฟะตัะตะทะฐะฟะธััะฒะฐัััั

## ะัะตะธะผััะตััะฒะฐ:

โ **ะะทะพะปััะธั:** ะัะต ัะบัะฟะตัะธะผะตะฝัั ะฒ ะพัะดะตะปัะฝะพะน ัะตััะธะธ
โ **ะะตะทะพะฟะฐัะฝะพััั:** ะัะบะฐั ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน `/session cancel`
โ **ะญััะตะบัะธะฒะฝะพััั:** ะะพะฟะธัััััั ัะพะปัะบะพ ะธะทะผะตะฝัะฝะฝัะต ัะฐะนะปั (CoW)
โ **Human retries:** ะกะพััะฐะฝััััั ะฒัะต ะฟะพะฟััะบะธ ะดะปั ะฐะฝะฐะปะธะทะฐ
โ **ะงะธัััะน workspace:** ะััะตัะฐะบัั ะธะทะพะปะธัะพะฒะฐะฝั ะฒ ัะตััะธะธ

---

**ะะฝัััะตะฝะฝัั ัะตะฐะปะธะทะฐัะธั:**

ะัะต ะบะพะผะฐะฝะดั ะฒัะทัะฒะฐัั ัะพะพัะฒะตัััะฒัััะธะต MCP tools ะธะท `session_management_mcp.py`:
- `/session start` โ `create_session()`
- `/session list` โ `list_sessions()`
- `/session status` โ `get_active_session()`
- `/session commit` โ `commit_session()`
- `/session cancel` โ `cancel_session()`
- `/session switch` โ `switch_session()`
- `/retry` โ `record_human_retry()`
