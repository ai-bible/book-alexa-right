# Agents Reference

Полный справочник всех агентов системы.

## Содержание

- [Координаторы](#координаторы)
- [Planning Workflow Agents](#planning-workflow-agents)
- [Generation Workflow Agents](#generation-workflow-agents)
- [Shared Agents](#shared-agents)
- [Utility Agents](#utility-agents)

---

## Координаторы

### planning-coordinator

**Назначение**: Управляет процессом Planning Workflow

**Когда вызывается**: Команда `/plan-story`

**Ответственность**:
- Ведёт интерактивный диалог с пользователем
- Определяет уровень планирования (act/chapter/scene/event)
- Координирует работу специализированных агентов
- Определяет какие агенты нужны на основе запроса
- Агрегирует результаты в финальный план

**Инструменты**: read_file, write_file, search_files

**Входы**: Запрос пользователя

**Выходы**: Финальный план (strategic/chapter/scene blueprint)

---

### director

**Назначение**: Управляет процессом Generation Workflow

**Когда вызывается**: При генерации сцены

**Ответственность**:
- Инициализирует session workspace
- Координирует агентов на этапах 0-11
- Синтезирует blueprint (этап 5)
- Агрегирует валидации (этап 8)
- Управляет итерациями
- Координирует интеграцию в контексты

**Инструменты**: read_file, write_file, search_files

**Входы**: Запрос пользователя или путь к blueprint

**Выходы**: Готовая сцена + обновлённые контексты

---

## Planning Workflow Agents

### Фаза 1: Исследование

#### dialogue-analyst

**Назначение**: Задаёт уточняющие вопросы пользователю

**Ответственность**:
- Формулирует релевантные вопросы на основе запроса
- Выявляет отправную точку и целевое состояние
- Определяет затрагиваемых персонажей
- Уточняет изменения мира

**Инструменты**: Нет (только диалог)

**Входы**: Запрос пользователя

**Выходы**: `/workspace/artifacts/phase-1/questions.md`

---

#### context-analyzer

**Назначение**: Анализирует текущее состояние мира и персонажей

**Ответственность**:
- Читает world-bible для определения состояния мира
- Читает character states для персонажей
- Читает plot-graph для сюжетных линий
- Выявляет ограничения канона

**Инструменты**: read_file, search_files

**Входы**: Контексты из `/context/`

**Выходы**: `/workspace/artifacts/phase-1/context-analysis.md`

---

### Фаза 2: Варианты

#### scenario-generator

**Назначение**: Генерирует 3-5 вариантов развития сюжета

**Ответственность**:
- Создаёт различные варианты пути от А до Б
- Описывает ключевые точки каждого варианта
- Определяет риски и возможности

**Инструменты**: read_file (для контекста)

**Входы**: Результаты Фазы 1

**Выходы**: `/workspace/artifacts/phase-2/scenarios.md`

---

#### consequence-predictor

**Назначение**: Прогнозирует последствия каждого варианта

**Ответственность**:
- Анализирует влияние на персонажей
- Определяет влияние на сюжетные линии
- Предсказывает изменения мира
- Оценивает долгосрочные последствия

**Инструменты**: read_file (storylines, character states)

**Входы**: Варианты от scenario-generator

**Выходы**: `/workspace/artifacts/phase-2/consequences.md`

---

#### world-impact-analyzer

**Назначение**: Анализирует влияние на мир (вызывается условно)

**Когда вызывается**: Если планируются новые элементы мира

**Ответственность**:
- Оценивает новые элементы на совместимость с каноном
- Определяет изменения существующих элементов
- Выявляет потенциальные противоречия

**Инструменты**: read_file (world-bible, canon-levels)

**Входы**: Варианты с новыми элементами

**Выходы**: `/workspace/artifacts/phase-2/world-impact.md`

---

### Фаза 3: План пути

#### arc-planner

**Назначение**: Разбивает путь от А до Б на события и сцены

**Ответственность**:
- Создаёт последовательность событий
- Разбивает события на сцены
- Определяет дугу главы/акта
- Устанавливает связи между событиями

**Инструменты**: read_file, write_file

**Входы**: Выбранный вариант развития

**Выходы**: `/workspace/artifacts/phase-3/arc-plan.md`

---

#### dependency-mapper

**Назначение**: Определяет зависимости между событиями

**Ответственность**:
- Выявляет причинно-следственные связи
- Определяет последовательные зависимости
- Находит параллельные линии
- Создаёт карту зависимостей

**Инструменты**: read_file

**Входы**: План из arc-planner

**Выходы**: `/workspace/artifacts/phase-3/dependencies.md`

---

### Фаза 4: Детализация

#### emotional-arc-designer

**Назначение**: Проектирует эмоциональные дуги персонажей

**Ответственность**:
- Определяет начальное эмоциональное состояние
- Планирует ключевые точки изменения
- Устанавливает конечное состояние
- Определяет мотивации и конфликты

**Инструменты**: read_file (character states, storylines)

**Входы**: План событий, список персонажей

**Выходы**: `/workspace/artifacts/phase-4/emotional-arcs.md`

---

#### beat-planner

**Назначение**: Разрабатывает ключевые биты для каждой сцены

**Ответственность**:
- Определяет структуру сцены (Цель-Конфликт-Катастрофа или Реакция-Дилемма-Решение)
- Разбивает на 4-6 ключевых битов
- Планирует диалоговые точки
- Определяет подтексты

**Инструменты**: read_file (структурные принципы)

**Входы**: План сцены из arc-planner

**Выходы**: `/workspace/artifacts/phase-4/scene-beats.md`

---

#### character-knowledge-updater

**Назначение**: Обновляет знания персонажей (вызывается условно)

**Когда вызывается**: Если персонажи узнают новую информацию

**Ответственность**:
- Определяет, что персонаж узнаёт
- Обновляет knowledge timeline
- Проверяет логику раскрытия информации

**Инструменты**: read_file, write_file

**Входы**: План событий, character knowledge

**Выходы**: Обновлённые `/context/characters/[name]/knowledge-timeline.md`

---

### Фаза 5: Интеграция

#### storyline-integrator

**Назначение**: Интегрирует план с существующими сюжетными линиями

**Ответственность**:
- Определяет влияние на каждую затронутую линию
- Обновляет прогресс сюжетных арок
- Выявляет связи с параллельными линиями
- Проверяет согласованность со скрытыми линиями

**Инструменты**: read_file, write_file (storylines)

**Входы**: Детальный план, список storylines

**Выходы**: `/workspace/artifacts/phase-5/storyline-integration.md`

---

#### impact-analyzer

**Назначение**: Анализирует общие последствия плана

**Ответственность**:
- Оценивает влияние на мир
- Определяет изменения персонажей
- Выявляет новые возможности для сюжета
- Определяет новые ограничения

**Инструменты**: read_file (все контексты)

**Входы**: Полный детальный план

**Выходы**: `/workspace/artifacts/phase-5/impact-analysis.md`

---

### Специализированные Planning агенты

#### storyline-developer

**Назначение**: Управление сюжетными линиями персонажей

**Когда вызывается**: Команда `/storyline`

**Ответственность**:
- Создаёт новые сюжетные линии
- Отвечает на запросы по линиям
- Обновляет существующие линии
- Анализирует влияние событий на линии

**Инструменты**: read_file, write_file, search_files

**Входы**: Команда и параметры

**Выходы**: Storyline файлы или ответы на запросы

---

#### consistency-checker

**Назначение**: Проверка согласованности после изменений

**Когда вызывается**: Команда `/check-consistency`

**Ответственность**:
- Анализирует изменения в планах
- Определяет влияние на написанные главы
- Выявляет противоречия
- Создаёт TODO-лист для вычитки

**Инструменты**: read_file, search_files

**Входы**: Изменённые планы, написанные главы

**Выходы**: `/workspace/consistency-checks/todo-[timestamp].md`

---

## Generation Workflow Agents

### Этап 1: Концептуальное планирование

#### plot-architect

**Назначение**: Создаёт сюжетный каркас сцены

**Ответственность**:
- Определяет место сцены в общей структуре
- Формулирует сюжетные задачи
- Определяет развиваемые линии
- Проверяет связь с предыдущими событиями

**Инструменты**: read_file, write_file (plot-graph)

**Входы**: Запрос пользователя или session init

**Выходы**: `/workspace/session-[ID]/artifacts/stage-1-plot/plot-framework.md`

---

### Этапы 2-4: Параллельная проработка

#### scene-structure

**Назначение**: Определяет структуру сцены

**Ответственность**:
- Применяет структуру Цель-Конфликт-Катастрофа или Реакция-Дилемма-Решение
- Разбивает на ключевые биты
- Определяет ритм и темп
- Расставляет точки напряжения

**Инструменты**: read_file (структурные принципы)

**Входы**: Plot framework

**Выходы**: `/workspace/session-[ID]/artifacts/stage-2-structure/scene-structure.md`

---

#### chronicle-keeper

**Назначение**: Управляет временной логикой и числами

**Ответственность**:
- Определяет временные рамки сцены
- Вычисляет место в хронологии
- Проверяет временную логику
- Фиксирует численные показатели
- Проверяет географическую логику

**Инструменты**: read_file, write_file (timeline)

**Входы**: Plot framework

**Выходы**: `/workspace/session-[ID]/artifacts/stage-2-structure/timeline.md`

---

#### world-lorekeeper

**Назначение**: Управляет элементами мира

**Ответственность**:
- Выбирает релевантные элементы из библии
- Определяет локацию
- Создаёт описание атмосферы
- Создаёт многоуровневые описания элементов
- Выявляет новые элементы в тексте (на этапе валидации)

**Инструменты**: read_file, write_file, search_files

**Входы**: Plot framework, world-bible

**Выходы**: `/workspace/session-[ID]/artifacts/stage-3-worldbuilding/world-elements.md`

---

#### canon-guardian

**Назначение**: Страж канона и его иерархии

**Ответственность**:
- Проверяет соответствие всем уровням канона (0-4)
- Определяет ограничения для сцены
- Классифицирует новые элементы (на валидации)
- Выявляет нарушения иерархии
- Ведёт журнал изменений канона

**Инструменты**: read_file, write_file (canon-levels)

**Входы**: World elements, canon-levels

**Выходы**: `/workspace/session-[ID]/artifacts/stage-3-worldbuilding/canon-check.md`

---

#### character-state

**Назначение**: Отслеживает состояния персонажей

**Ответственность**:
- Определяет эмоциональные состояния (вход и выход)
- Фиксирует известную персонажам информацию
- Планирует эволюцию состояний
- Определяет мотивации
- Проверяет реалистичность (на валидации)

**Инструменты**: read_file, write_file (characters)

**Входы**: Plot framework, character files

**Выходы**: `/workspace/session-[ID]/artifacts/stage-4-characters/character-map.md`

---

#### dialogue-weaver

**Назначение**: Планирует диалоги в Planning Phase 4

**Когда вызывается**: Planning Workflow Phase 4 (детализация)

**Ответственность**:
- Планирует ключевые диалоговые обмены для сцен
- Определяет речевые паттерны персонажей
- Проектирует подтексты и скрытые смыслы
- Отслеживает информационный обмен между персонажами
- Создает отдельные файлы планов для каждого диалога
- **ВСЕГДА пишет планы в файлы, НЕ возвращает полный контент**

**Инструменты**: read_file, write_file

**Входы**:
- Beat plans (какие сцены имеют диалоги)
- Character-map (состояния персонажей)
- Emotional arcs (эмоциональный контекст)

**Выходы**:
- Отдельные файлы планов: `/workspace/artifacts/dialogue-plans/[character]-[dialogue-name].md`
- Сводка: `/workspace/artifacts/dialogue-plans/00-summary.md`
- Возвращает пользователю: краткий summary (2-3 предложения на файл)

---

### Этап 6: Генерация

#### sci-fi-world-writer

**Назначение**: Создаёт литературный текст

**Ответственность**:
- Генерирует текст на основе blueprint
- Применяет принцип МРБ (Мотивация-Реакция)
- Соблюдает структуру битов
- Интегрирует все элементы
- Поддерживает стиль и атмосферу

**Инструменты**: read_file, write_file

**Входы**: Blueprint

**Выходы**: `/workspace/session-[ID]/artifacts/stage-6-draft/scene-draft.md`

---

### Этап 7: Валидация

Все агенты этапов 2-4 работают как валидаторы:

- **world-lorekeeper**: выявляет новые элементы, проверяет использование
- **dialogue-weaver**: проверяет диалоги
- **chronicle-keeper**: проверяет временную логику
- **canon-guardian**: проверяет канон
- **plot-architect**: проверяет сюжетные задачи
- **character-state**: проверяет персонажей
- **scene-structure**: проверяет структуру

Каждый создаёт: `/workspace/session-[ID]/artifacts/stage-7-validation/[agent]-validation.md`

---

### Этап 11: Интеграция

Агенты обновляют контексты:

- **world-lorekeeper**: обновляет world-bible
- **canon-guardian**: обновляет canon-levels
- **chronicle-keeper**: обновляет timeline
- **plot-architect**: обновляет plot-graph

---

## Таблица агентов по workflows

| Агент | Planning | Generation | Shared |
|-------|----------|------------|--------|
| planning-coordinator | ✅ | ❌ | ❌ |
| director | ❌ | ✅ | ❌ |
| dialogue-analyst | ✅ | ❌ | ❌ |
| context-analyzer | ✅ | ❌ | ❌ |
| scenario-generator | ✅ | ❌ | ❌ |
| consequence-predictor | ✅ | ❌ | ❌ |
| world-impact-analyzer | ✅ | ❌ | ❌ |
| arc-planner | ✅ | ❌ | ❌ |
| dependency-mapper | ✅ | ❌ | ❌ |
| emotional-arc-designer | ✅ | ❌ | ❌ |
| beat-planner | ✅ | ❌ | ❌ |
| character-knowledge-updater | ✅ | ❌ | ❌ |
| storyline-integrator | ✅ | ❌ | ❌ |
| impact-analyzer | ✅ | ❌ | ❌ |
| storyline-developer | ✅ | ❌ | ❌ |
| consistency-checker | ✅ | ❌ | ❌ |
| scene-structure | ❌ | ✅ | ❌ |
| sci-fi-world-writer | ❌ | ✅ | ❌ |
| plot-architect | ✅ | ✅ | ✅ |
| chronicle-keeper | ❌ | ✅ | ✅ |
| world-lorekeeper | ✅ | ✅ | ✅ |
| canon-guardian | ✅ | ✅ | ✅ |
| character-state | ✅ | ✅ | ✅ |
| dialogue-weaver | ✅ | ❌ | ❌ |
| dialogue-choreographer | ❌ | ✅ | ❌ |
| dialogue-analyst | ❌ | ✅ | ❌ |

---

## Инструменты агентов

### Стандартные инструменты

- **read_file**: Чтение файлов из проекта
- **write_file**: Запись файлов
- **search_files**: Поиск в файлах
- **list_directory**: Просмотр содержимого каталога

### Специализированные

Некоторые агенты не используют инструменты (только диалог):
- dialogue-analyst
- scenario-generator (только логика)
- emotional-arc-designer (только читает контекст)

---

**Версия**: 1.0  
**Последнее обновление**: 2025